---
layout: posts
title: "Stock Price Correlation Matrix"
date: 2019-11-02
tags: [python, excel, web scraping, portfolio]
category: python
---
 
 Background
 Instructions
 Limitations/Future Work
 
 -- insert outline here 
 
 # Background
  
This project is based on an assignment from a course I took in undergrad, *Analyzing Economic Data*, taught by Mr. Abe Padilla. 
The name of the course was a little misleading, as this was more of a data modeling course that focused on various analytical techniques and software common in the workplace.  
My analytical foundation was built taking this course, and to this day Abe Padilla is a great friend and colleague of mine. 
<br>

In this course, we worked on the assignment that can be found here.
The goal was to be able to take data gathered from Yahoo Finance and put the stocks into a correlation matrix to identify which stocks were positively and negatively correlated. 
This of course is a valuable tool to be able to quickly see the diversification of your stock portfolio, for example. 
Looking back at these old assignments, the intial setup for this project was a drag to be quite frank. There was a lot of manual setup work that needed to be done in order to build the matrix. 
It's not terrible work, but manual work nonetheless. Abe Padilla always told me, "if you have to do more work than press a button, you're doing too much work." I agree with this, most of the time. 
However, this project is something that I felt can be completed with the push of a button, and that's exactly what I did. 
<br>


The most manual process of the first version of this model was having to go to Yahoo Finance and manually download data for each individual stock and then paste the information
into Excel. As mentioned above, I hate manual work and avoid it as much as I can. Yahoo Finance utilizes various elements like buttons and drop downs on their website
to pull the stock data to the user's specifications. After doing some research, I came across an testing suite known as Selenium. Selenium focuses on automating web-based applications and can be used in different ways. 
With Selenium, I was able to inspect the HTML of a webpage, identify the elements that needed to be modified, and change them accordingly in Python. I would categorize this as web-scraping,
but this is a very light web-scraping model at best. 
A web-driver is needed to interface with a browser and will be needed to be downloaded prior to running this model (instructions down below). Chrome is my main browser of choice, but there are web-drivers for Edge, Firefox, and Safari available. 
If any other browser other than chrome is being used, I will include isntructions to appropriately change the code to work with these various drivers. -- "Should I include this??"
<br>

The next portion of the model is to calculate the continous return of each stock on a monthly basis, based on the original model, but can be change to the various intervals available on Yahoo Finance. 
This was done in a way a little more manual than I originally intended, but couldnt get past an obstacle when combining all of the stock data files into a Pandas dataframe. That will be explained below. 
Lastly, the correlation matrix needs to be built, to which VBA was used to automate this process. 
<br>

# Instructions 
<br>


As previously mentioned, the first part is to download the Selenium webdriver, which can be found <a href="https://www.seleniumhq.org/download/">here</a>.
This webdriver also needs to be added to yout PATH environment variables. If you do not know how to add a variable to your PATH, click <a href="https://www.architectryan.com/2018/03/17/add-to-the-path-on-windows-10/">here</a> for a Windows 10 tutorial. 
Then we need to install two packages for the model, pandas and selenium. The versions that I was using at the time for pandas and selnium were 0.25.1 and 3.141.0 respectively.  
<br>

```console
pip install pandas selenium
```
<br>




Once we have our packages installed, we need to make some changes to our python file that was downloaded. First we need to change our path variables. The two directories are **maindir**, where the files
from the VBA code in our Excel file will export to, and **stocksfolder**, where you want the stock data files to download to. Note that file path for **maindir** needs the file path that is deinfed in the VBA code.
<br>

```python

# directory where vba from Excel file exports the requested stocks to and where the final stocks file gets saved to
maindir = "C:\\Users\\rodri\\Desktop\\Website Projects\\Python\\Stock Price Correlation" 
# directory where stocks will be kept
stocksfolder = "C:\\Users\\rodri\\Desktop\\Website Projects\\Python\\Stock Price Correlation\\Stocks CSV"

```
<br>


Next we need to change the directory in our Excel. When the Excel file is open, hit Alt + F11 to open the VBA code. Change the variable exportPath to the same file path as **maindir**.
<br>

```vbnet
Dim exportPath As String
exportPath = "C:\\Users\\rodri\\Desktop\\Website Projects\\Python\\Stock Price Correlation\\" ' THIS IS PATH FROM PYTHON SCRIPT
```
<br>






Below is the main video I used to set up this jekyll site:
- <a href="https://www.youtube.com/watch?v=qWrcgHwSG8M">https://www.youtube.com/watch?v=qWrcgHwSG8M</a>

It's simple video to use and gets the basics set up for starting a site. However, it is about a year old so there were some changes that needed to be made. It is also a very simple video, 
and jekyll has a lot to offer. Below are some other sites/videos that I used to further develop this website:
- <a href="https://jekyllrb.com/">https://jekyllrb.com/</a>
- <a href="https://www.youtube.com/watch?v=T1itpPvFWHI&list=PLLAZ4kZ9dFpOPV5C5Ay0pHaa0RJFhcmcB">https://www.youtube.com/watch?v=T1itpPvFWHI&list=PLLAZ4kZ9dFpOPV5C5Ay0pHaa0RJFhcmcB</a>
